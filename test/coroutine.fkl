(define max 10)
(define buf (chanl max))

(define (producer)
  (let iter [(c 0)]
    (when (< c max)
      (println "produce:" c)
      (send buf c)
      (iter (1+ c))))
  (println "producer exit"))

(define (consumer)
  (let iter [(c 0)]
    (when (< c max)
      (println "consume:" (recv buf))
      (iter (1+ c))))
  (println "consumer exit"))

(let iter [(c 0)]
  (when (< c max)
    (go producer)
    (go consumer)
    (iter (1+ c))))

