(define max 10)
(define buf (chanl max))

(define (producer)
  (do [(c 0 (1+ c))]
    [(>= c max)]
    (println "produce:" c)
    (send buf c))
  (println "producer exit"))

(define (consumer)
  (do [(c 0 (1+ c))]
    [(>= c max)]
    (println "consume:" (recv buf)))
  (println "consumer exit"))

(do [(c 0 (1+ c))]
  [(>= c max)]
  (go producer)
  (go consumer))

