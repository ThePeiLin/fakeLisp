(import (only (.. lib utils) assert))

(define v #(foo bar))
(println (vec-ref v 0))
(assert (eq (vec-first v) 'foo))
(println (vec-first v))
(assert (eq (vec-last v) 'bar))
(println (vec-last v))

(prin1n (define vd #vd(1 2 3 4 5)))
(prin1n (dvec-insert! vd 2 'foo))
(prin1n (dvec-insert! vd 3 'bar))
(prin1n (dvec-insert! vd 0 'foobar))
(prin1n vd)
(assert (eqv (length vd) 8))
(prin1n (length vd))
(assert (eqv (dvec-capacity vd) 10))
(prin1n (dvec-capacity vd))

(prin1n (define vd #vd(1 2 3 4 5 6)))
(prin1n (dvec-insert! vd 2 10 'foo))
(assert (eqv (dvec-capacity vd) 16))
(printf "capacity %s\n" (dvec-capacity vd))
(assert (eqv (length vd) 16))
(printf "length: %s\n" (length vd))
(prin1n (dvec-insert! vd 3 2 'bar))
(assert (eqv (dvec-capacity vd) 32))
(printf "capacity: %s\n" (dvec-capacity vd))
(assert (eqv (length vd) 18))
(printf "length: %s\n" (length vd))
(prin1n (dvec-insert! vd 3 0 'bar))
(assert (eqv (dvec-capacity vd) 32))
(printf "capacity: %s\n" (dvec-capacity vd))
(assert (eqv (length vd) 18))
(printf "length: %s\n" (length vd))

(define another-vd  (copy vd))
(prin1n another-vd)

(assert (eqv (dvec-capacity another-vd) 18))
(printf "capacity %s\n" (dvec-capacity another-vd))
(assert (eqv (length another-vd) 18))
(printf "length: %s\n" (length another-vd))

(define len (+ (length vd)
               (length another-vd)
               (length #(114 514))))

(prin1n (append! vd another-vd #vd(114 514)))
(assert (eqv len (length vd)))
(printf "expect length: %s, actual length: %s\n"
        len
        (length vd))

(define len (+ (length vd)
               (length another-vd)
               (length #(114 514))))
(define vvd (append vd another-vd #vd(114 514)))
(prin1n vvd)
(assert (eqv len (length vvd)))
(printf "expect length: %s, actual length: %s\n"
        len
        (length vvd))


(define s "foo")
(assert (equal (append s "bar" "114" "514")
               "foobar114514"))
(prin1n (append s "bar" "114" "514"))
(append! s "bar" "114" "514")
(assert (equal s "foobar114514"))
(prin1n s)

(define b #vu8(1 2 3))
(assert (equal (append b #vu8(4 5 6) #vu8(11 22 33) #vu8(44 55 66))
               #vu8(1 2 3 4 5 6 11 22 33 44 55 66)))
(prin1n (append b #vu8(4 5 6) #vu8(11 22 33) #vu8(44 55 66)))
(append! b #vu8(4 5 6) #vu8(11 22 33) #vu8(44 55 66))
(assert (equal b #vu8(1 2 3 4 5 6 11 22 33 44 55 66)))
(prin1n b)

(define v #(foo bar))
(assert (equal (append v #(bar foo))
               #(foo bar bar foo)))
(prin1n (append v #(bar foo)))

(define l '(1 2 3))
(assert (equal (append l '(4 5 6) '(7 8 9))
               '(1 2 3 4 5 6 7 8 9)))
(prin1n (append l '(4 5 6) '(7 8 9)))
(append! l '(4 5 6) '(7 8 9))
(assert (equal l '(1 2 3 4 5 6 7 8 9)))
(prin1n l)
