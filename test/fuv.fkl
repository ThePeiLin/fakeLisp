(import (prefix (.. lib fuv) uv-))

(define loop (uv-make-loop))

(define timer (uv-make-timer loop))

(println (uv-handle-type timer))

(define (on-close) (println "im closing!"))

(uv-timer-start! timer
                 (lambda ()
                   (println "time out!")
                   (uv-timer-stop! timer)
                   (uv-handle-close! timer on-close))
                 500
                 500)

(uv-loop-run! loop 'default)

(define timer (uv-make-timer loop))

(uv-timer-start! timer
                 (lambda ()
                   (println "time out again!")
                   (uv-loop-stop! loop)
                   (println "stop the loop!"))
                 500
                 500)

(uv-loop-configure! loop 'loop-block-signal 'sigprof)
(uv-loop-configure! loop 'metrics-idle-time)

(uv-loop-walk loop println)

(uv-loop-run! loop)
