(import (prefix (.. .. lib fuv) uv-))

(import (only (.. .. lib utils m) assert))

(define loop (uv-make-loop))

(define res (uv-getaddrinfo loop nil "http"))

(assert res)

(println "sync dns resolved")

(foreach prin1n res)

(newline)

(define (on-resloved err res)
  (assert (not err))
  (println "async dns resolved")
  (foreach prin1n res)
  (assert (eqv (hash-ref (car res) 'port) 80)))

(define req (uv-getaddrinfo loop nil "http" on-resloved))

(assert (uv-req? req))
(assert (uv-getaddrinfo? req))
(uv-loop-run loop)
