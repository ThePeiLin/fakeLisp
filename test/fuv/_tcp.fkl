(import (prefix (.. .. lib fuv) uv-))

(import (only (.. .. lib utils m) assert))

(define loop (uv-make-loop))

(define tcp (uv-make-tcp loop))

(assert (uv-tcp? tcp))
(assert (uv-stream? tcp))
(assert (uv-handle? tcp))

(uv-tcp-nodelay tcp 1)
(uv-tcp-simultaneous-accepts tcp 1)
(assert (eq (error-type (prin1n (pcall uv-tcp-keepalive tcp 1)))
            'arg-error))
(assert (eq (error-type (prin1n (pcall uv-tcp-keepalive tcp nil 114)))
            'arg-error))
(uv-tcp-keepalive tcp 1 114)

(define socketpair (uv-socketpair 'stream nil 1 1))
(prin1n socketpair)

(define tcp (uv-make-tcp loop))

(uv-tcp-open tcp (cdr socketpair))

(prin1n (uv-tcp-sockname tcp))

(prin1n (uv-tcp-peername tcp))
