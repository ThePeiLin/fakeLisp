(import (.. lib ht))
(import (only (.. lib utils m) assert))

(define hash-table (make-ht equal-hashv equal))

(prin1 (ht-hashv hash-table))
(newline)
(prin1 (ht-equal hash-table))
(newline)

(ht-set! hash-table 'foo 'bar)
(ht-set! hash-table 'foo 'foobar)
(ht-set! hash-table 'bar 'barfoo)
(ht-set*! hash-table 'fizz 'buzz 114 514)

(princ "\nht-ref 'foo")
(newline)
(assert (eq (println (ht-ref hash-table 'foo))
            'foobar))

(princ "\nht-ref 'foobar 'foofoo")
(newline)
(assert (eq (println (ht-ref hash-table 'foobar 'foofoo))
            'foofoo))

(princ "\nht-ref! 'foobar 'foofoo")
(newline)
(assert (eq (println (ht-ref! hash-table 'foobar 'foofoo))
            'foofoo))

(princ "\nht-ref! 'foobar 'barbar")
(newline)
(assert (eq (println (ht-ref! hash-table 'foobar 'barbar))
            'foofoo))

(princ "\nht-ref& 'foobar")
(newline)
(assert (equal (println (ht-ref& hash-table 'foobar))
               #&foofoo))

(princ "\nht-ref& 'foofoo")
(newline)
(assert (eq (println (ht-ref& hash-table 'foofoo))
            '()))

(princ "\nht-ref$ 'foobar")
(newline)
(assert (equal (println (ht-ref$ hash-table 'foobar))
               '(foobar,foofoo)))

(princ "\nht-ref$ 'foofoo")
(newline)
(assert (eq (println (ht-ref$ hash-table 'foofoo))
            '()))

(princ "\nbefore ht-del!")
(newline)
(prin1 (ht->list hash-table))
(newline)
(prin1 (ht-keys hash-table))
(newline)
(prin1 (ht-values hash-table))
(newline)

(princ "\nht-del! 'foobar")
(newline)
(assert (equal (println (ht-del! hash-table 'foobar))
               '(foobar,foofoo)))

(princ "\nht-del! 'foofoo")
(newline)
(assert (eq (println (ht-del! hash-table 'foofoo))
               '()))

(newline)
(princ "before clear")
(newline)
(prin1 (ht->list hash-table))
(newline)
(prin1 (ht-keys hash-table))
(newline)
(prin1 (ht-values hash-table))
(newline)

(princ "after clear")
(newline)
(ht-clear! hash-table)
(prin1 (ht->list hash-table))
(newline)
(prin1 (ht-keys hash-table))
(newline)
(prin1 (ht-values hash-table))
(newline)
